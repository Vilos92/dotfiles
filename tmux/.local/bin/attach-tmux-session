#!/bin/sh

session_name=$1
directory=$2
shift 2
command_to_run="$@"

if [ -z "$session_name" ]; then
    echo "Usage: attach-tmux-session <session-name> [directory] [command...]"
    exit 1
fi

set -- -s "$session_name"

if [ -n "$directory" ]; then
    set -- "$@" -c "$directory"
fi

if [ -n "$command_to_run" ]; then
    set -- "$@" "$command_to_run"
fi

if [ -z "$TMUX" ]; then
    tmux new-session -A "$@"
    exit 0
fi

if ! tmux has-session -t="$session_name" 2>/dev/null; then
    tmux new-session -d "$@"
fi

tmux switch-client -t="$session_name"
