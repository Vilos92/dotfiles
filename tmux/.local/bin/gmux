#!/bin/sh

project_paths=$(find "$GREG_PROJECTS_PATH" "$FRONTAPP_DIR" -mindepth 1 -maxdepth 1 -type d)
projects=$(echo "$project_paths" | xargs -n 1 basename)

sessions=$(tmux list-sessions | awk -F: '{ print $1 }')

options=$(echo "$projects" | while read project; do
  if echo "$sessions" | grep -qx "$project"; then
    echo "$project (*)"
  else
    echo "$project"
  fi
done)

selected_option=$(echo "$options" | fzf --ansi --tmux 80%)

if [[ -z $selected_option ]]; then
  exit 0
fi

selected_project=$(echo "$selected_option" | sed 's/\(.*\) .*/\1/')
selected_project_path=$(echo "$project_paths" | grep -F "$selected_project")

if [[ -z $selected_project_path ]]; then
  exit 0
fi

attach-tmux-session $selected_project $selected_project_path

