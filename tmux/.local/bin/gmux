#!/bin/sh

project_paths=$(find "$GREG_PROJECTS_PATH" "$FRONTAPP_DIR" -mindepth 1 -maxdepth 1 -type d)
projects=$(echo "$project_paths" | xargs -n 1 basename)

sessions=$(tmux list-sessions 2>/dev/null | awk -F: '{ print $1 }')

current_session=$(tmux list-sessions -F "#{session_name}" -f "#{session_attached}" 2>/dev/null)

options=$(echo "$projects" | while read project; do
  if [[ "$project" = "$current_session" ]]; then
    echo "ðŸŸ¢ $project"
  elif echo "$sessions" | grep -qx "$project"; then
    echo "ðŸ”µ $project"
  else
    echo "ðŸŒ‘ $project"
  fi
done)

selected_option=$(echo "$options" | fzf --ansi --tmux 80%)

if [[ -z $selected_option ]]; then
  exit 0
fi

selected_project=$(echo "$selected_option" | awk '{print $2}')

selected_project_path=$(echo "$project_paths" | grep "/$selected_project$" | head -n 1)

if [[ -z $selected_project_path ]]; then
  exit 0
fi

attach-tmux-session $selected_project $selected_project_path

