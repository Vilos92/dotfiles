#!/bin/sh

# ==============================================================================
#
#                            !!! IMPORTANT !!!
#
# This script performs a ONE-WAY MIRROR backup.
#
# The LaCie drives ("Lacie" and "LaCie Small") are the DESTINATION. They are
# intended to be an exact copy of the source files.
#
# Data flows FROM:
#   - /Volumes/Elements/
#   - ~/Desktop/Mac Vault/
#
# Data flows TO:
#   - /Volumes/Lacie/
#   - /Volumes/LaCie Small/
#
# Because this script uses the --delete flag, any file that exists on the
# LaCie drives but NOT on the source drives will be PERMANENTLY DELETED
# from the LaCie drives during the sync.
#
# DO NOT STORE UNIQUE FILES IN THE LACIE DRIVE VAULTS.
#
# The only exception to this is the `Cold Local Vault`. These are permanently archived
# files that no longer add utility (they have been scrapped for parts).
#
# ==============================================================================

# --- üõ°Ô∏è Safety Check & Global Options ---
# This script is in DRY-RUN mode by default.
# Pass the --execute flag as the first argument to make real changes.
RSYNC_OPTS="-av --progress --delete" # Base options
if [ "$1" == "--execute" ]; then
    echo "‚úÖ --execute flag detected. Live backup mode engaged."
else
    echo "üõ°Ô∏è SAFE MODE: Running in simulation (dry-run) mode."
    RSYNC_OPTS="$RSYNC_OPTS --dry-run"
fi
echo "===================================================="


# --- Stage 1: Local Vault Backup (Elements -> LaCie) ---
echo "‚ñ∂Ô∏è  Starting Stage 1: Local Vault Backup"
# --- Configuration for Stage 1 ---
LV_SOURCE_DRIVE="/Volumes/Elements/Local Vault/media"
LV_DEST_DRIVE="/Volumes/Lacie/Local Vault/media"
LV_DIRS_TO_SYNC=( "concerts" "audio books" "music" "zim" "software" "roms" )
LV_SHOWS_TO_SYNC=( "HarmonQuest" "The Vietnam War 2017" "Samurai Jack" "Documentary Now!" )

# --- Logic for Stage 1 ---
for dir in "${LV_DIRS_TO_SYNC[@]}"; do
    SOURCE_PATH="$LV_SOURCE_DRIVE/$dir/"
    DEST_PATH="$LV_DEST_DRIVE/$dir/"
    if [ -d "$SOURCE_PATH" ]; then
        echo "üîÑ Syncing: $dir"
        rsync $RSYNC_OPTS "$SOURCE_PATH" "$DEST_PATH"
    else
        echo "‚ö†Ô∏è  Skipping, not found: $SOURCE_PATH"
    fi
done
for show in "${LV_SHOWS_TO_SYNC[@]}"; do
    SOURCE_PATH="$LV_SOURCE_DRIVE/shows/$show/"
    DEST_PATH="$LV_DEST_DRIVE/shows/$show/"
    if [ -d "$SOURCE_PATH" ]; then
        echo "üîÑ Syncing show: $show"
        rsync $RSYNC_OPTS "$SOURCE_PATH" "$DEST_PATH"
    else
        echo "‚ö†Ô∏è  Skipping, not found: $SOURCE_PATH"
    fi
done
echo "----------------------------------------------------"


# --- Stage 2: Cloud Vault Backup (Elements -> LaCie Small) ---
echo "‚ñ∂Ô∏è  Starting Stage 2: Cloud Vault Backup"
# --- Configuration for Stage 2 ---
CV_SOURCE_DRIVE="/Volumes/Elements/Cloud Vault"
CV_DEST_DRIVE="/Volumes/LaCie Small/Cloud Vault"
CV_DIRS_TO_SYNC=( "GoPro" "video renders" )

# --- Logic for Stage 2 ---
for dir in "${CV_DIRS_TO_SYNC[@]}"; do
    SOURCE_PATH="$CV_SOURCE_DRIVE/$dir/"
    DEST_PATH="$CV_DEST_DRIVE/$dir/"
    if [ -d "$SOURCE_PATH" ]; then
        echo "üîÑ Syncing: $dir"
        rsync $RSYNC_OPTS "$SOURCE_PATH" "$DEST_PATH"
    else
        echo "‚ö†Ô∏è  Skipping, not found: $SOURCE_PATH"
    fi
done
echo "----------------------------------------------------"


# --- Stage 3: Mac Vault Backup (Desktop -> LaCie Small) ---
echo "‚ñ∂Ô∏è  Starting Stage 3: Mac Vault Backup"
# --- Configuration for Stage 3 ---
MV_SOURCE_BASE="$HOME/Desktop/Mac Vault"
MV_DEST_BASE="/Volumes/LaCie Small/Mac Vault"
MV_DIRS_TO_SYNC=( "Music Production" "llm_models" "Greg News" )

# --- Logic for Stage 3 ---
for dir in "${MV_DIRS_TO_SYNC[@]}"; do
    SOURCE_PATH="$MV_SOURCE_BASE/$dir/"
    DEST_PATH="$MV_DEST_BASE/$dir/"
    if [ -d "$SOURCE_PATH" ]; then
        echo "üîÑ Syncing: $dir"
        rsync $RSYNC_OPTS "$SOURCE_PATH" "$DEST_PATH"
    else
        echo "‚ö†Ô∏è  Skipping, not found: $SOURCE_PATH"
    fi
done
echo "----------------------------------------------------"

echo "‚úÖ All backup stages finished."
